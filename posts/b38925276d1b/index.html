

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://lly-blog-img.oss-cn-hangzhou.aliyuncs.com/images/luoyuy-favicon.jpeg">
  <link rel="icon" href="https://lly-blog-img.oss-cn-hangzhou.aliyuncs.com/images/luoyuy-favicon.jpeg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="LuoYu-Ying">
  <meta name="keywords" content="">
  
    <meta name="description" content="Android 中 Activity 的常见的疑问。">
<meta property="og:type" content="article">
<meta property="og:title" content="Activity 知识点快问快答">
<meta property="og:url" content="https://luoyuy.top/posts/b38925276d1b/index.html">
<meta property="og:site_name" content="洛语 の Blog">
<meta property="og:description" content="Android 中 Activity 的常见的疑问。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lly-blog-img.oss-cn-hangzhou.aliyuncs.com/images/index-img-android-activity.png">
<meta property="article:published_time" content="2022-05-21T08:40:02.000Z">
<meta property="article:modified_time" content="2023-03-04T11:58:51.481Z">
<meta property="article:author" content="LuoYu-Ying">
<meta property="article:tag" content="Activity">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://lly-blog-img.oss-cn-hangzhou.aliyuncs.com/images/index-img-android-activity.png">
  
  
  
  <title>Activity 知识点快问快答 - 洛语 の Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"luoyuy.top","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>洛语 の Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Activity 知识点快问快答"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-05-21 16:40" pubdate>
          2022年5月21日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          13k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          110 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Activity 知识点快问快答</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Activity的启动流程"><a href="#Activity的启动流程" class="headerlink" title="Activity的启动流程"></a><code>Activity</code>的启动流程</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/cpcpcp123/article/details/122055099">面试：Activity的启动流程简述_沙漠一只雕得儿得儿的博客-CSDN博客_activity启动流程面试</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6c55c169ba54">Android 系统启动 - SystemServer 进程 - 简书 (jianshu.com)</a></li>
</ul>
</blockquote>
<p>大致为以下过程：</p>
<ol>
<li><code>Launcher</code> 通过 <code>startActivity</code> 方法调用 <code>AMS</code>。</li>
<li><code>AMS</code> 向 <code>Zygote</code> 进程发送创建应用进程的请求。</li>
<li><code>Zygote</code> 进程接受请求并在 <code>main</code> 方法中孵化应用进程。</li>
<li>应用进程通过<code>SystemServer#main</code>启动<code>ActivityThread</code>。</li>
<li><code>Activity</code>的入口是<code>ActivityThread</code>的<code>main</code>函数，在<code>main</code>函数中创建一个新的<code>ActivityThread</code>对象，开启消息循环(UI线程)后创建新的<code>Activity</code>。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// SystemServer#main</span><br>    <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemServer</span>().run();<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>    ···<br>    <span class="hljs-comment">// Ensure binder calls into the system always run at foreground priority.</span><br>    <span class="hljs-comment">// 确保当前进程的 binder 调用总是运行在前台优先级</span><br>    BinderInternal.disableBackgroundScheduling(<span class="hljs-literal">true</span>);<br>    ···<br>    <span class="hljs-comment">// 创建主线程 Looper</span><br>    Looper.prepareMainLooper();<br><br>    <span class="hljs-comment">// Initialize native services.</span><br>    <span class="hljs-comment">// 加载android_servers.so库，该库包含的源码在frameworks/base/services/目录下</span><br>    System.loadLibrary(<span class="hljs-string">&quot;android_servers&quot;</span>);<br>    ···<br>    <span class="hljs-comment">// Initialize the system context.</span><br>    <span class="hljs-comment">// 初始化系统上下文</span><br>    createSystemContext();<br><br>    <span class="hljs-comment">// Create the system service manager.</span><br>    <span class="hljs-comment">//创建系统服务管理</span><br>    mSystemServiceManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemServiceManager</span>(mSystemContext);<br>    <span class="hljs-comment">// 将mSystemServiceManager添加到本地服务的成员sLocalServiceObjects</span><br>    LocalServices.addService(SystemServiceManager.class, mSystemServiceManager);<br><br>    <span class="hljs-comment">// Start services.</span><br>    <span class="hljs-comment">//  启动各种系统服务</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        startBootstrapServices(); <span class="hljs-comment">// 启动引导服务</span><br>        startCoreServices();      <span class="hljs-comment">// 启动核心服务</span><br>        startOtherServices();     <span class="hljs-comment">// 启动其他服务</span><br>    &#125; <span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>        ···<br>    &#125;<br>    ···<br>    <span class="hljs-comment">// Loop forever.</span><br>    <span class="hljs-comment">// 启动 Looper 循环</span><br>    Looper.loop();<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Main thread loop unexpectedly exited&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h1 id="onSaveInstanceState和onRestoreInstanceState的调用时机"><a href="#onSaveInstanceState和onRestoreInstanceState的调用时机" class="headerlink" title="onSaveInstanceState和onRestoreInstanceState的调用时机"></a><code>onSaveInstanceState</code>和<code>onRestoreInstanceState</code>的调用时机</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/cpcpcp123/article/details/113396301">Android onSaveInstanceState和onRestoreInstanceState调用时机、及大小限制_沙漠一只雕得儿得儿的博客-CSDN博客_onsaveinstancestate</a></li>
</ul>
</blockquote>
<p><strong><font size = "5">onSaveInstanceState(Bundle outState)</font></strong></p>
<p>当 Activity 在不正常销毁的情况下，就会调用 onSaveInstanceState 方法，并将 Activity 中需要保存的数据（比如 View 状态 或者我们自己的数据）保存到这个方法的参数 Bundle 中。</p>
<p><strong>onSaveInstanceState(Bundle outState)会在以下情况被调用</strong>：</p>
<ol>
<li>当用户按下HOME键时。</li>
<li>从最近应用中选择运行其他的程序时。</li>
<li>按下电源按键（关闭屏幕显示）时。</li>
<li>从当前activity启动一个新的activity时。</li>
<li>屏幕方向切换时(无论竖屏切横屏还是横屏切竖屏都会调用)。</li>
</ol>
<p><strong>Activity的onSaveInstanceState回调时机，取决于app的targetSdkVersion</strong>：</p>
<ul>
<li><p>targetSdkVersion低于11的app，onSaveInstanceState方法会在Activity.onPause之前回调；</p>
</li>
<li><p>targetSdkVersion低于28的app，则会在onStop之前回调；</p>
</li>
<li><p><strong>28之后，onSaveInstanceState在onStop回调之后才回调。</strong></p>
</li>
</ul>
<p><strong><font size = "5">onRestoreInstanceState(Bundle savedInstanceState)</font></strong></p>
<p>onRestoreInstanceState(Bundle savedInstanceState)只有在activity确实是被系统回收，重新创建activity的情况下才会被调用。</p>
<p><strong>onRestoreInstanceState(Bundle outState)会在以下情况被调用</strong>：</p>
<ol>
<li>屏幕方向切换时（无论竖屏切横屏还是横屏切竖屏都会调用）</li>
<li>由于内存紧张导致后台运行的程序被kill掉时（这种不太好模拟）</li>
</ol>
<p><strong>onRestoreInstanceState(Bundle outState)</strong> 的回调时机：</p>
<p>回调发生在<code>onStart</code>回调之后。</p>
<hr>
<h1 id="onCreate和onRestoreInstance方法中恢复数据时的区别"><a href="#onCreate和onRestoreInstance方法中恢复数据时的区别" class="headerlink" title="onCreate和onRestoreInstance方法中恢复数据时的区别"></a><code>onCreate</code>和<code>onRestoreInstance</code>方法中恢复数据时的区别</h1><p>因为<code>onSaveInstanceState</code> 不一定会被调用，所以<code>onCreate</code>里的<code>Bundle</code>参数可能为空，如果使用<code>onCreate</code>来恢复数据，一定要做非空判断。</p>
<p>而<code>onRestoreInstanceState</code>的<code>Bundle</code>参数一定不会是空值，因为它只有在上次<code>activity</code>被回收了才会调用。</p>
<hr>
<h1 id="Activity的数据是怎么保存的-进程被Kill后-保存的数据怎么恢复的？"><a href="#Activity的数据是怎么保存的-进程被Kill后-保存的数据怎么恢复的？" class="headerlink" title="Activity的数据是怎么保存的,进程被Kill后,保存的数据怎么恢复的？"></a><code>Activity</code>的数据是怎么保存的,进程被<code>Kill</code>后,保存的数据怎么恢复的？</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li>《Android 开发艺术探索》</li>
</ul>
</blockquote>
<img src="https://lly-blog-img.oss-cn-hangzhou.aliyuncs.com/images/20220521185305.png" srcset="/img/loading.gif" lazyload style="zoom:67%;" />

<p>通过<code>onSaveInstanceState</code>方法和<code>onRestoreInstanceState</code>方法进行数据的保存和恢复。</p>
<p>在 <code>onSaveInstanceState</code>和 <code>onRestoreInstanceState</code>方法中，系统自动为我们做了一定的恢复工作。当 <code>Activity</code> 在异常情况下需要重新创建时，系统会默认为我们保存当前<code>Activity</code> 的视图结构，并且在<code>Activity</code>重启后为我们恢复这些数据，比如文本框中用户输入的数据、<code>ListView</code>滚动的位置等。</p>
<hr>
<h1 id="Activity的启动模式和使用场景"><a href="#Activity的启动模式和使用场景" class="headerlink" title="Activity的启动模式和使用场景"></a><code>Activity</code>的启动模式和使用场景</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_14849739/article/details/78072401">Android中Activity的启动模式（LaunchMode）和使用场景_Shawpoo的博客-CSDN博客_launchmode</a></li>
</ul>
</blockquote>
<p>Activity的启动模式有四种：<b><code>standard</code>、<code>singleTop</code>、<code>singleTask</code>和<code>singleInstance</code></b>。</p>
<p><strong><font size="5">standard：标准模式</font></strong></p>
<p>这种启动模式为标准模式，也是默认模式。每当我们启动一个Activity，系统就会相应的创建一个实例，不管这个实例是否已经存在。这种模式，一个栈中可以有多个实例，每个实例也都有自己的任务栈。而且是谁启动了此Activity，那么这个Activity就运行在启动它的Activity所在的栈中。</p>
<p><strong>分析总结</strong></p>
<p><strong>标准模式下，只要启动一次Activity，系统就会在当前任务栈新建一个实例。</strong></p>
<p><strong>使用场景</strong></p>
<p>正常的去打开一个新的页面，这种启动模式使用最多，最普通 。</p>
<p><strong><font size="5">singleTop：栈顶复用模式</font></strong></p>
<p>这种启动模式下，如果要启动的Activity已经处于栈的顶部，那么此时系统不会创建新的实例，而是直接打开此页面，同时它的onNewIntent()方法会被执行，我们可以通过Intent进行传值，而且它的onCreate()，onStart()方法不会被调用，因为它并没有发生任何变化。</p>
<p><strong>分析总结</strong></p>
<ol>
<li>当前栈中已有该Activity的实例并且该实例位于栈顶时，不会创建实例，而是复用栈顶的实例，并且会将Intent对象传入，回调onNewIntent()方法；</li>
<li>当前栈中已有该Activity的实例但是该实例不在栈顶时，其行为和standard启动模式一样，依然会创建一个新的实例；</li>
<li>当前栈中不存在该Activity的实例时，其行为同standard启动模式。</li>
</ol>
<p><strong>使用场景</strong></p>
<p>这种模式应用场景的话，假如一个新闻客户端，在通知栏收到了3条推送，点击每一条推送会打开新闻的详情页，如果为默认的启动模式的话，点击一次打开一个页面，会打开三个详情页，这肯定是不合理的。如果启动模式设置为singleTop，当点击第一条推送后，新闻详情页已经处于栈顶，当我们第二条和第三条推送的时候，只需要通过Intent传入相应的内容即可，并不会重新打开新的页面，这样就可以避免重复打开页面了。</p>
<p><strong><font size="5">singleTask：栈内复用模式</font></strong></p>
<p>在这个模式下，如果栈中存在这个Activity的实例就会复用这个Activity，不管它是否位于栈顶，复用时，会将它上面的Activity全部出栈，因为singleTask本身自带clearTop这种功能。并且会回调该实例的onNewIntent()方法。其实这个过程还存在一个任务栈的匹配，因为这个模式启动时，会在自己需要的任务栈中寻找实例，这个任务栈就是通过taskAffinity属性指定。如果这个任务栈不存在，则会创建这个任务栈。不设置taskAffinity属性的话，默认为应用的包名。</p>
<p><strong>分析总结</strong></p>
<p>在复用的时候，首先会根据taskAffinity去找对应的任务栈：</p>
<ol>
<li>如果不存在指定的任务栈，系统会新建对应的任务栈，并新建Activity实例压入栈中。</li>
<li>如果存在指定的任务栈，则会查找该任务栈中是否存在该Activity实例<ol>
<li>如果不存在该实例，则会在该任务栈中新建Activity实例。</li>
<li>如果存在该实例，则会直接引用，并且回调该实例的onNewIntent()方法。并且任务栈中该实例之上的Activity会被全部销毁。</li>
</ol>
</li>
</ol>
<p><strong>使用场景</strong></p>
<p>SingleTask这种启动模式最常使用的就是一个APP的首页，因为一般为一个APP的第一个页面，且长时间保留在栈中，所以最适合设置singleTask启动模式来复用。</p>
<p><strong><font size="5">singleInstance：单实例模式</font></strong></p>
<p>单实例模式，顾名思义，只有一个实例。该模式具备singleTask模式的所有特性外，与它的区别就是，这种模式下的<strong>Activity会单独占用一个Task栈，具有全局唯一性</strong>，即整个系统中就这么一个实例，由于栈内复用的特性，后续的请求均不会创建新的Activity实例，除非这个特殊的任务栈被销毁了。以singleInstance模式启动的Activity在整个系统中是单例的，如果在启动这样的Activiyt时，已经存在了一个实例，那么会把它所在的任务调度到前台，重用这个实例。</p>
<p><strong>分析总结</strong></p>
<p>启动该模式Activity的时候，会查找系统中是否存在：</p>
<ol>
<li>不存在，首先会新建一个任务栈，其次创建该Activity实例。</li>
<li>存在，则会直接引用该实例，并且回调onNewIntent()方法。</li>
<li>特殊情况：该任务栈或该实例被销毁，系统会重新创建。</li>
</ol>
<p><strong>使用场景</strong></p>
<p>很常见的是，电话拨号盘页面，通过自己的应用或者其他应用打开拨打电话页面 ，只要系统的栈中存在该实例，那么就会直接调用。</p>
<p><strong><font size="5">总结</font></strong></p>
<p>在使用APP过程中，不可避免页面之间的跳转，那么就会涉及到启动模式。其实在对界面进行跳转时，Android系统既能在同一个任务中对Activity进行调度，也能以Task（任务栈）为单位进行整体调度。在启动模式为standard或singleTop时，一般是在同一个任务中对Activity进行调度，而在启动模式为singleTask或singleInstance是，一般会对Task进行整体调度。</p>
<hr>
<h1 id="Activity的onNewIntent方法什么时候会执行"><a href="#Activity的onNewIntent方法什么时候会执行" class="headerlink" title="Activity的onNewIntent方法什么时候会执行"></a><code>Activity</code>的<code>onNewIntent</code>方法什么时候会执行</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8897068505d8">Android中的onNewIntent()函数 - 简书 (jianshu.com)</a></li>
</ul>
</blockquote>
<p><strong>使用<code>SingleTask</code>以及<code>SingleInstance</code>启动模式的时候，会调用<code>onNewInstant</code>方法。</strong></p>
<p> <code>Activity</code>第一次启动的时候执行<code>onCreate</code> -&gt; <code>onStart</code> -&gt; <code>onResume</code>等后续生命周期函数，也就时说第一次启动Activity并不会执行到<code>onNewIntent</code>。</p>
<p>而后面如果再有想启动<code>Activity</code>的时候，那就是执行 <b><code>onNewIntent</code> -&gt; <code>onResart</code> -&gt; <code>onStart</code> -&gt; <code>onResume</code></b>。</p>
<p>如果Android系统由于内存不足把已存在<code>Activity</code>释放掉了，那么再次调用的时候会重新启动<code>Activity</code>即执行<code>onCreate</code> -&gt; <code>onStart</code> -&gt; <code>onResume</code>等。</p>
<p>当调用到<code>onNewIntent(intent)</code>的时候，需要在<code>onNewIntent</code>中使用<code>setIntent(intent)</code>赋值给<code>Activity</code>的<code>Intent</code>。否则，后续的<code>getIntent</code>都是得到旧的<code>Intent</code>。</p>
<hr>
<h1 id="Activity-生命周期"><a href="#Activity-生命周期" class="headerlink" title="Activity 生命周期"></a><code>Activity</code> 生命周期</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><p>《Android 开发艺术探索》</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiajun2356033/article/details/78741121">activity生命周期（这篇足够了）_android_Mr_夏的博客-CSDN博客</a></p>
</li>
</ul>
</blockquote>
<img src="https://lly-blog-img.oss-cn-hangzhou.aliyuncs.com/images/20220521182943.png" srcset="/img/loading.gif" lazyload alt="Activity的生命周期" style="zoom:67%;" />

<ol>
<li><p><code>onCreate</code></p>
<p>表示 Activity 正在被创建，这是生命周期的第一个方法。在这个方法中，我们可以做一些<strong>初始化工作</strong>，比如调用 <strong>setContentView</strong> 去加载界面布局资源、初始化 Activity 所需数据等。</p>
</li>
<li><p><code>onStart</code></p>
<p>表示 Activity 正在被启动，即将开始，这时 Activity已经<strong>可见</strong>了，但是还<strong>没有出现在前台</strong>，还<strong>无法和用户交互</strong>。这个时候其实可以理解为 Activity 已经显示出来了，但是我们还<strong>看不到</strong>。</p>
</li>
<li><p><code>onResume</code></p>
<p>表示 Activity <strong>已经可见</strong>了，并且<strong>出现在前台并开始活动</strong>。</p>
<p>要注意这个和 onStart 的对比，onStart 和 onResume 都表示 Activity 已经可见，但是 onStart 的时候 Activity 还在后台，onResume 的时候 Activity 才显示到前台。</p>
</li>
<li><p><code>onPause</code></p>
<p>表示 Activity 正在停止，正常情况下，紧接着 onStop 就会被调用。</p>
<p>在特殊情况下，如果这个时候快速地再回到当前 Activity，那么 onResume 会被调用。笔者的理解是，这种情况属于极端情况，用户操作很难重现这一场景。</p>
<p><strong>当前 Activity 是可见的，但不能与用户交互状态（即不在前台）。</strong></p>
<p>此时可以做一些<strong>存储数据、停止动画</strong>等工作，但是注意<strong>不能太耗时</strong>，因为这会影响到新 Activity 的显示，<strong>onPause 必须先执行完，新 Activity 的 onResume 才会执行。</strong></p>
</li>
<li><p><code>onStop</code></p>
<p>表示 Activity 即将停止，此时 Activity 对用户是<strong>不可见</strong>的，可以做一些稍微重量级的回收工作，同样<strong>不能太耗时</strong>。</p>
<p>在系统内存紧张的情况下，有可能会被系统进行回收，所以一般在当前方法可做资源回收。</p>
</li>
<li><p><code>onDestroy</code></p>
<p>表示 Activity 即将被销毁，这是 Activity 生命周期中的最后一个回调，在这里我们可以做一些<strong>回收工作和最终的资源释放</strong>。</p>
</li>
<li><p><code>onRestart</code></p>
<p>表示 Activity 正在重新启动。一般情况下，当当前 Activity 从<strong>不可见重新变为可见状态</strong>时，onRestart 就会被调用。</p>
<p>这种情形一般是用户行为所导致的，比如用户按 Home 键切换到桌面或者用户打开了一个新的 Activity，这时当前的 Activity 就会暂停，也就是 onPause 和 onStop 被执行了，接着用户又回到了这个 Activity，就会出现这种情况。</p>
</li>
</ol>
<p><strong>具体情况分析</strong>：</p>
<ol>
<li><p>针对一个特定的 Activity，<strong>第一次启动</strong>，回调如下：<code>onCreate</code> -&gt; <code>onStart</code> -&gt; <code>onResume</code>。</p>
</li>
<li><p>当用户<strong>打开新的 Activity</strong> 或者<strong>切换到桌面</strong>的时候，回调如下： <code>onPause</code> -&gt; <code>onStop</code>。</p>
<p>这里有一种特殊情况，如果新 Activity 采用了透明主题,那么当前 Activity 不会回调 <code>onStop</code>。</p>
</li>
<li><p>当用户<strong>再次回到原 Activity</strong> 时，回调如下： <code>onRestart</code> -&gt; <code>onStart</code> -&gt; <code>onResume</code>。</p>
</li>
<li><p>当用户<strong>按 back 键回退</strong>时，回调如下：<code>onPause</code> -&gt; <code>onStop</code> -&gt; <code>onDestroy</code>。</p>
</li>
<li><p>当 <strong>Activity 被系统回收后再次打开</strong>，生命周期方法回调过程和（1）一样，注意只是生命周期方法一样，不代表所有过程都一样，比如 <code>onSaveInstanceState</code> 和 <code>onRestoreInstanceState</code> 的调用。</p>
</li>
<li><p>从 <strong>Activity_A跳转到Activity_B</strong>，会先执行 A 活动的 <code>onPause</code>，再执行 B 活动的 <code>onResume</code>。</p>
</li>
<li><p>从<strong>整个生命周期</strong>来说，<code>onCreate</code> 和 <code>onDestroy</code> 是配对的，分别标识着 Activity 的创建和销毁，并且只可能有一次调用。</p>
</li>
<li><p>从 <strong>Activity 是否可见</strong>来说，<code>onStart</code> 和 <code>onStop</code> 是配对的，随着用户的操作或者设备屏幕的点亮和熄灭，这两个方法可能被调用多次。</p>
</li>
<li><p>从 <strong>Activity 是否在前台</strong>来说，<code>onResume</code>和 <code>onPause</code>是配对的，随着用户操作或者设备屏幕的点亮和熄灭，这两个方法可能被调用多次。</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>生命周期</th>
<th>是否可见</th>
<th>是否在前台</th>
</tr>
</thead>
<tbody><tr>
<td><code>onStart</code></td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td><code>onResume</code></td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td><code>onPause</code></td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td><code>onStop</code></td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<hr>
<h1 id="onStart-和-onResume、onPause-和-onStop-的区别"><a href="#onStart-和-onResume、onPause-和-onStop-的区别" class="headerlink" title="onStart 和 onResume、onPause 和 onStop 的区别"></a><code>onStart</code> 和 <code>onResume</code>、<code>onPause</code> 和 <code>onStop</code> 的区别</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li>《Android 开发艺术探索》</li>
</ul>
</blockquote>
<p>从实际使用过程来说，<code>onStart</code>和 <code>onResume</code>、<code>onPause</code>和 <code>onStop</code>看起来的确差不多，甚至我们可以只保留其中一对，比如只保留<code>onStart</code>和 <code>onStop</code>。既然如此,那为什么Android系统还要提供看起来重复的接口呢？</p>
<p>根据上面的分析，我们知道，这两个配对的回调分别表示不同的意义，<code>onStart</code>和 <code>onStop</code>是从<strong>Activity是否可见</strong>这个角度来回调的，而 <code>onResume</code>和 <code>onPause</code>是从<strong>Activity是否位于前台</strong>这个角度来回调的，除了这种区别，在实际使用中没有其他明显区别。</p>
<hr>
<h1 id="Activity的显式启动和隐式启动"><a href="#Activity的显式启动和隐式启动" class="headerlink" title="Activity的显式启动和隐式启动"></a><code>Activity</code>的显式启动和隐式启动</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/lrq851215/article/details/62881056">显示和隐式启动Activity的方式_卩s秋灬的博客-CSDN博客</a></li>
</ul>
</blockquote>
<p>启动Activity主要是通过Intent（意图）来实现。主要分为显示的和隐式的两种。</p>
<p><strong><font size="4">隐式启动 <code>Activity</code></font></strong></p>
<p>优点：</p>
<ol>
<li>只要知道被启动<code>Activity</code>的<code>Action</code>和<code>Category</code>即可，不用知道对应的类名或者是包名。</li>
<li>只要<code>Activity</code>有对应的<code>Action</code>和<code>Category</code>都会被启动起来。然后提供给用户选择要启动哪一个。</li>
</ol>
<p> 需要被启动的<code>Activity</code>，需要在自己的<code>AndroidManifest.xml</code>定义对应的<code>action</code> 和 <code>category</code>。     </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.android.activity.demo.SecondActivity&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:label</span>=<span class="hljs-string">&quot;@string/second_activity_name&quot;</span> &gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.action.SECONDACTIVITY_START&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>启动<code>Activity</code>的地方，把对应的<code>Action</code>填入即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startSecondActivityByAction</span><span class="hljs-params">()</span> &#123;<br>    Log.d(TAG, <span class="hljs-string">&quot;startSecondActivityByAction()&quot;</span>);<br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>    intent.setAction(<span class="hljs-string">&quot;android.intent.action.SECONDACTIVITY_START&quot;</span>);<br>    intent.addCategory(Intent.CATEGORY_DEFAULT);<br>    <span class="hljs-keyword">try</span> &#123;<br>        startActivity(intent);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;start activity error!&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong><font size="4">显示启动 <code>Activity</code></font></strong></p>
<p>不足：</p>
<ol>
<li>被启动的应用的包名或者类名发生变化后，就会无法启动。</li>
</ol>
<p>通过类名类启动Activity， 一般是同一个APK里面使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startSecondActivityByClass</span><span class="hljs-params">()</span> &#123;<br>    Log.d(TAG, <span class="hljs-string">&quot;startSecondActivityByClass()&quot;</span>);<br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(FirstActivity.<span class="hljs-built_in">this</span>, SecondActivity.class);<br>    <span class="hljs-keyword">try</span> &#123;<br>        startActivity(intent);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;start activity error!&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h1 id="Activity间传递数据的方式"><a href="#Activity间传递数据的方式" class="headerlink" title="Activity间传递数据的方式"></a><code>Activity</code>间传递数据的方式</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010112268/article/details/83832021">关于Android Activity之间传递数据的6种方式_淼淼1111的博客-CSDN博客_activity传递数据</a></li>
</ul>
</blockquote>
<p>共六种传递数据的方式。</p>
<ol>
<li><p><strong>使用Intent的putExtra传递</strong></p>
<p>第一个Activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//创建意图对象</span><br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-built_in">this</span>,TwoActivity.class);<br><span class="hljs-comment">//设置传递键值对</span><br>intent.putExtra(<span class="hljs-string">&quot;data&quot;</span>,str);<br><span class="hljs-comment">//激活意图</span><br>startActivity(intent);<br></code></pre></td></tr></table></figure>

<p>第二个Activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 获取意图对象</span><br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> getIntent();<br><span class="hljs-comment">//获取传递的值</span><br><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;data&quot;</span>);<br><span class="hljs-comment">//设置值</span><br>tv.setText(str);<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>使用Intention的Bundle传递</strong></p>
<p>第一个Activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//创建意图对象</span><br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MainActivity.<span class="hljs-built_in">this</span>,TwoActivity.class);<br><span class="hljs-comment">//用数据捆传递数据</span><br><span class="hljs-type">Bundle</span> <span class="hljs-variable">bundle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>();<br>bundle.putString(<span class="hljs-string">&quot;data&quot;</span>, str);<br><span class="hljs-comment">//把数据捆设置改意图</span><br>intent.putExtra(<span class="hljs-string">&quot;bun&quot;</span>, bundle);<br><span class="hljs-comment">//激活意图</span><br>startActivity(intent);<br></code></pre></td></tr></table></figure>

<p>第二个Activity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//获取Bundle</span><br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> getIntent();<br><span class="hljs-type">Bundle</span> <span class="hljs-variable">bundle</span> <span class="hljs-operator">=</span> intent.getBundleExtra(<span class="hljs-string">&quot;bun&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> bundle.getString(<span class="hljs-string">&quot;data&quot;</span>);<br>tv.setText(str);<br></code></pre></td></tr></table></figure>


</li>
<li><p><strong>使用Activity销毁时传递数据(startActivityForResult)</strong></p>
<p>第一个Activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MainActivity.<span class="hljs-built_in">this</span>,TwoActivity.class);<br><span class="hljs-comment">//用一种特殊方式开启Activity</span><br>startActivityForResult(intent, <span class="hljs-number">11</span>);<br><br><span class="hljs-comment">//设置数据</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onActivityResult</span><span class="hljs-params">(<span class="hljs-type">int</span> requestCode, <span class="hljs-type">int</span> resultCode, Intent data)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onActivityResult(requestCode, resultCode, data);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> data.getStringExtra(<span class="hljs-string">&quot;data&quot;</span>);<br>    tvOne.setText(str);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>第二个activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//设置返回的数据</span><br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>intent.putExtra(<span class="hljs-string">&quot;data&quot;</span>, edtOne.getText().toString().trim());<br>setResult(<span class="hljs-number">3</span>, intent);<br><span class="hljs-comment">//关闭当前activity</span><br>finish();<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>SharedPreferences传递数据</strong></p>
<p>第一个Activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SharedPreferences</span> <span class="hljs-variable">sp</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getSharedPreferences(<span class="hljs-string">&quot;info&quot;</span>, <span class="hljs-number">1</span>);<br><span class="hljs-comment">//获取sp编辑器</span><br><span class="hljs-type">Editor</span> <span class="hljs-variable">edit</span> <span class="hljs-operator">=</span> sp.edit();<br>edit.putString(<span class="hljs-string">&quot;data&quot;</span>, str);<br>edit.commit();<br><span class="hljs-comment">//创建意图对象</span><br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MainActivity.<span class="hljs-built_in">this</span>,TwoActivity.class);<br><span class="hljs-comment">//激活意图</span><br>startActivity(intent);<br></code></pre></td></tr></table></figure>

<p>第二个activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SharedPreferences</span> <span class="hljs-variable">sp</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getSharedPreferences(<span class="hljs-string">&quot;info&quot;</span>, <span class="hljs-number">1</span>);<br><span class="hljs-comment">//设置数据</span><br>tv.setText(sp.getString(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;&quot;</span>));<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>使用序列化对象Seriazable</strong></p>
<p>工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String sex;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSex</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sex;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSex</span><span class="hljs-params">(String sex)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sex = sex;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>第一个Activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//创建意图</span><br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MainActivity.<span class="hljs-built_in">this</span>,TwoActivity.class);<br><span class="hljs-type">DataBean</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataBean</span>();<br><span class="hljs-comment">//通过set方法把数据保存到DataBean对象中</span><br>bean.setName(<span class="hljs-string">&quot;啦啦&quot;</span>);<br>bean.setSex(<span class="hljs-string">&quot;男&quot;</span>);<br>intent.putExtra(<span class="hljs-string">&quot;key&quot;</span>, bean);<br>startActivity(intent);<br></code></pre></td></tr></table></figure>

<p>第二个Activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> getIntent();<br><span class="hljs-comment">//反序列化数据对象</span><br><span class="hljs-type">Serializable</span> <span class="hljs-variable">se</span> <span class="hljs-operator">=</span> intent.getSerializableExtra(<span class="hljs-string">&quot;key&quot;</span>);<br><span class="hljs-keyword">if</span>(se <span class="hljs-keyword">instanceof</span> DataBean)&#123;<br>    <span class="hljs-comment">//获取到携带数据的DataBean对象db</span><br>    <span class="hljs-type">DataBean</span> <span class="hljs-variable">db</span> <span class="hljs-operator">=</span> (DataBean) se;<br>    tv.setText(db.getName() + <span class="hljs-string">&quot;===&quot;</span> + db.getSex());<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>使用静态变量传递数据</strong></p>
<p>第一个Activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MainActivity.<span class="hljs-built_in">this</span>,TwoActivity.class);<br>TwoActivity.name = <span class="hljs-string">&quot;NAME&quot;</span>;<br>TwoActivity.str = <span class="hljs-string">&quot;STR&quot;</span>;<br>startActivity(intent);<br></code></pre></td></tr></table></figure>

<p>第二个Activity中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//静态变量</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> String name;<br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> String str;<br>tv.setText(str + name);<br></code></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="有哪些Activity常用的标记位Flags"><a href="#有哪些Activity常用的标记位Flags" class="headerlink" title="有哪些Activity常用的标记位Flags"></a>有哪些<code>Activity</code>常用的标记位<code>Flags</code></h1><ol>
<li><p><code>FLAG_ACTIVITY_NEW_TASK</code></p>
<p>指定启动模式为SingleTask</p>
</li>
<li><p><code>FLAG_ACTIVITY_SINGLE_TOP</code></p>
<p>指定启动模式为SingleTop</p>
</li>
<li><p><code>FLAG_ACTIVITY_CLEAR_TOP</code></p>
<p>一般与SingleTask启动模式一起出现，启动时位于它上方的Activity出栈，如果被启动的Activity实例已存在，系统则会调用它的onNewIntent</p>
</li>
</ol>
<hr>
<h1 id="Activity任务栈是什么"><a href="#Activity任务栈是什么" class="headerlink" title="Activity任务栈是什么"></a><code>Activity</code>任务栈是什么</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Lwenlong/p/15939583.html">Android面试——Activity篇 - 向着内核前进！ - 博客园 (cnblogs.com)</a></li>
</ul>
</blockquote>
<p>即Task，栈结构，存放Activity；退出应用程序时只有将所有任务栈找那个的所有Activity出栈，任务栈才能销毁。</p>
<p>任务栈可以移动到后台，在其中保留每一个Activity的状态。</p>
<p>对应的类：ActivityRecord、TaskRecord、ActivityStack。</p>
<hr>
<h1 id="跨App启动Activity的方式-注意事项"><a href="#跨App启动Activity的方式-注意事项" class="headerlink" title="跨App启动Activity的方式,注意事项"></a>跨<code>App</code>启动<code>Activity</code>的方式,注意事项</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Lwenlong/p/15939583.html">Android面试——Activity篇 - 向着内核前进！ - 博客园 (cnblogs.com)</a></li>
<li>《Android 开发艺术探索》</li>
</ul>
</blockquote>
<ol>
<li><p>指定打开的应用</p>
<p>通过 Intent 隐式启动时，如果有多个 action 值相同的 Activity，系统会让你选择启动哪个，解决办法时通过指定 Intent-filter 的 <code>data</code> 属性，Intent 则要加上一个 URI，该 URI 的 scheme 必须与 data 的 scheme 相同。</p>
<blockquote>
<p>  data 由两部分组成，mimeType 和 URI。mimeType 指媒体类型，比如 image&#x2F;ijpeg、audio&#x2F;mpeg4-generic 和 video&#x2F;* 等，可以表示图片、文本、视频等不同的媒体格式，而 URI 中包含的数据就比较多了，下面是 URI 的结构：</p>
  <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;scheme&gt;<span class="hljs-symbol">://&lt;host&gt;</span><span class="hljs-symbol">:&lt;port&gt;/</span>[&lt;path&gt;|&lt;pathPrefix&gt;|&lt;pathPattern&gt;]<br></code></pre></td></tr></table></figure>

<p>  Scheme：URI 的模式，比如 http、file、content等，如果 URI 中没有指定 scheme，那么整个 URI 的其他参数无效，这也意味着 URI 是无效的。</p>
</blockquote>
</li>
<li><p>如何防止自己的 Activity 被外部非正常启动</p>
<p>给自己的 Activity 添加 <code>android:permission=”xxx.xxx.xx”</code>，那么想要访问你的 Activity 就必须声明 <code>uses-permission xxx.xxx.xx</code>。</p>
</li>
</ol>
<hr>
<h1 id="ANR-的四种场景"><a href="#ANR-的四种场景" class="headerlink" title="ANR 的四种场景"></a><code>ANR</code> 的四种场景</h1><blockquote>
<p>  答案参考自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/xingyu19911016/article/details/122080235">ANR 的四种场景_橙子19911016的博客-CSDN博客_anr的四种场景</a></li>
</ul>
</blockquote>
<ol>
<li><p><code>Service TimeOut</code></p>
<p><code>Service</code>未在规定时间执行完成，前台服务20s，后台200s。</p>
</li>
<li><p><code>BroadCastQueue TimeOut</code></p>
<p>未在规定时间内未处理完广播，前台广播10s内，后台60s内。</p>
</li>
<li><p><code>ContentProvider TimeOut</code></p>
<p><code>publish</code>在10s内没有完成。</p>
</li>
<li><p><code>Input Dispatching timeout</code></p>
<p>5s内未响应键盘输入、触摸屏幕等事件。</p>
</li>
</ol>
<p>Activity的生命周期回调的阻塞并不在触发ANR的场景里面，所以并不会直接触发ANR。 只不过死循环阻塞了主线程，如果系统再有上述的四种事件发生，就无法在相应的时间内处理从而触发ANR。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Android/" class="category-chain-item">Android</a>
  
  

      </span>
    
  
    
      <span class="category-chain">
        
  <a href="/categories/%E9%9D%A2%E8%AF%95%E6%95%B4%E7%90%86-2022/" class="category-chain-item">面试整理-2022</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Activity/">#Activity</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Activity 知识点快问快答</div>
      <div>https://luoyuy.top/posts/b38925276d1b/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>LuoYu-Ying</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年5月21日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/8a4aa21deb03/" title="BroadcastReceiver 简单介绍">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">BroadcastReceiver 简单介绍</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/383eeff4bc2c/" title="ArrayList 你知道更多吗？">
                        <span class="hidden-mobile">ArrayList 你知道更多吗？</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/fluid-js/duration.js"></script> </div> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<!-- hexo injector body_end start --><script src="/fluid-js/postTimeleness.js"></script><!-- hexo injector body_end end --></body>
</html>
